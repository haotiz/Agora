var Agora=function(){var c={};Object.defineProperties(c,{version:{get:function(){return"<%= pkg.version %>"}},name:{get:function(){return"<%= pkg.title %>"}}});return c}(),L={};Agora.EventDispatcher=function(c){var a={};c.dispatcher={};c.dispatcher.eventListeners={};a.addEventListener=function(a,d){void 0===c.dispatcher.eventListeners[a]&&(c.dispatcher.eventListeners[a]=[]);c.dispatcher.eventListeners[a].push(d)};a.on=a.addEventListener;a.removeEventListener=function(a,d){var e;e=c.dispatcher.eventListeners[a].indexOf(d);-1!==e&&c.dispatcher.eventListeners[a].splice(e,1)};a.dispatchEvent=function(a){var d;L.Logger.debug("Event: "+a.type);for(d in c.dispatcher.eventListeners[a.type])if(c.dispatcher.eventListeners[a.type].hasOwnProperty(d))c.dispatcher.eventListeners[a.type][d](a)};
return a};Agora.LicodeEvent=function(c){var a={};a.type=c.type;return a};Agora.StreamEvent=function(c){var a=Agora.LicodeEvent(c);a.stream=c.stream;a.msg=c.msg;return a};Agora.ClientEvent=function(c){var a=Agora.LicodeEvent(c);a.user=c.user;a.attr=c.attr;a.streams=c.streams;return a};Agora.MediaEvent=function(c){var a=Agora.LicodeEvent(c);a.msg=c.msg;return a};Agora.FcStack=function(){return{addStream:function(){}}};Agora.FirefoxStack=function(c){var a={},b=mozRTCPeerConnection,d=mozRTCSessionDescription,e=!1;a.pc_config={iceServers:[]};c.iceServers instanceof Array?c.iceServers.map(function(b){0===b.url.indexOf("stun:")&&a.pc_config.iceServers.push({url:b.url})}):c.stunServerUrl&&(c.stunServerUrl instanceof Array?c.stunServerUrl.map(function(b){"string"===typeof b&&""!==b&&a.pc_config.iceServers.push({url:b})}):"string"===typeof c.stunServerUrl&&""!==c.stunServerUrl&&a.pc_config.iceServers.push({url:c.stunServerUrl}));
void 0===c.audio&&(c.audio=!0);void 0===c.video&&(c.video=!0);a.mediaConstraints={offerToReceiveAudio:c.audio,offerToReceiveVideo:c.video,mozDontOfferDataChannel:!0};a.roapSessionId=103;a.peerConnection=new b(a.pc_config);a.peerConnection.onicecandidate=function(b){L.Logger.debug("PeerConnection: ",c.session_id);if(b.candidate)a.iceCandidateCount=a.iceCandidateCount+1;else{L.Logger.debug("State: "+a.peerConnection.iceGatheringState);if(a.ices===void 0)a.ices=0;a.ices=a.ices+1;L.Logger.debug(a.ices);
if(a.ices>=1&&a.moreIceComing){a.moreIceComing=false;a.markActionNeeded()}}};L.Logger.debug('Created webkitRTCPeerConnnection with config "'+JSON.stringify(a.pc_config)+'".');a.processSignalingMessage=function(b){L.Logger.debug("Activity on conn "+a.sessionId);b=JSON.parse(b);a.incomingMessage=b;if(a.state==="new")if(b.messageType==="OFFER"){b={sdp:b.sdp,type:"offer"};a.peerConnection.setRemoteDescription(new d(b),function(){L.Logger.debug("setRemoteDescription succeeded")},function(a){L.Logger.info("setRemoteDescription failed: "+
a.name)});a.state="offer-received";a.markActionNeeded()}else a.error("Illegal message for this state: "+b.messageType+" in state "+a.state);else if(a.state==="offer-sent")if(b.messageType==="ANSWER"){b.sdp=b.sdp.replace(/ generation 0/g,"");b.sdp=b.sdp.replace(/ udp /g," UDP ");b.sdp=b.sdp.replace(/a=group:BUNDLE audio video/,"a=group:BUNDLE sdparta_0 sdparta_1");b.sdp=b.sdp.replace(/a=mid:audio/,"a=mid:sdparta_0");b.sdp=b.sdp.replace(/a=mid:video/,"a=mid:sdparta_1");b={sdp:b.sdp,type:"answer"};L.Logger.debug("Received ANSWER: ",
b.sdp);a.peerConnection.setRemoteDescription(new d(b),function(){L.Logger.debug("setRemoteDescription succeeded")},function(a){L.Logger.info("setRemoteDescription failed: "+a)});a.sendOK();a.state="established"}else if(b.messageType==="pr-answer"){b={sdp:b.sdp,type:"pr-answer"};a.peerConnection.setRemoteDescription(new d(b),function(){L.Logger.debug("setRemoteDescription succeeded")},function(a){L.Logger.info("setRemoteDescription failed: "+a.name)})}else b.messageType==="offer"?a.error("Not written yet"):
a.error("Illegal message for this state: "+b.messageType+" in state "+a.state);else if(a.state==="established")if(b.messageType==="OFFER"){b={sdp:b.sdp,type:"offer"};a.peerConnection.setRemoteDescription(new d(b),function(){L.Logger.debug("setRemoteDescription succeeded")},function(a){L.Logger.info("setRemoteDescription failed: "+a.name)});a.state="offer-received";a.markActionNeeded()}else a.error("Illegal message for this state: "+b.messageType+" in state "+a.state)};a.addStream=function(b){e=true;
a.peerConnection.addStream(b);a.markActionNeeded()};a.removeStream=function(){a.markActionNeeded()};a.close=function(){a.state="closed";a.peerConnection.close()};a.markActionNeeded=function(){a.actionNeeded=true;a.doLater(function(){a.onstablestate()})};a.doLater=function(a){window.setTimeout(a,1)};a.onstablestate=function(){var b;if(a.actionNeeded){if(a.state==="new"||a.state==="established"){L.Logger.debug("Creating offer");if(e)a.mediaConstraints=void 0;(function(){a.peerConnection.createOffer(function(b){var c=
b.sdp;L.Logger.debug("Changed",b.sdp);if(c!==a.prevOffer){a.peerConnection.setLocalDescription(b);a.state="preparing-offer";a.markActionNeeded()}else L.Logger.debug("Not sending a new offer")},function(a){L.Logger.debug("Ups! Something went wrong ",a)},a.mediaConstraints)})()}else if(a.state==="preparing-offer"){if(a.moreIceComing)return;a.prevOffer=a.peerConnection.localDescription.sdp;L.Logger.debug("Sending OFFER: ",a.prevOffer);a.sendMessage("OFFER",a.prevOffer);a.state="offer-sent"}else if(a.state===
"offer-received")a.peerConnection.createAnswer(function(b){a.peerConnection.setLocalDescription(b);a.state="offer-received-preparing-answer";if(a.iceStarted)a.markActionNeeded();else{L.Logger.debug((new Date).getTime()+": Starting ICE in responder");a.iceStarted=true}},function(){L.Logger.debug("Ups! Something went wrong")});else if(a.state==="offer-received-preparing-answer"){if(a.moreIceComing)return;b=a.peerConnection.localDescription.sdp;a.sendMessage("ANSWER",b);a.state="established"}else a.error("Dazed and confused in state "+
a.state+", stopping here");a.actionNeeded=false}};a.sendOK=function(){a.sendMessage("OK")};a.sendMessage=function(b,c){var e={};e.messageType=b;e.sdp=c;if(b==="OFFER"){e.offererSessionId=a.sessionId;e.answererSessionId=a.otherSessionId;e.seq=a.sequenceNumber=a.sequenceNumber+1;e.tiebreaker=Math.floor(Math.random()*429496723+1)}else{e.offererSessionId=a.incomingMessage.offererSessionId;e.answererSessionId=a.sessionId;e.seq=a.incomingMessage.seq}a.onsignalingmessage(JSON.stringify(e))};a.error=function(a){throw"Error in RoapOnJsep: "+
a;};a.sessionId=a.roapSessionId+=1;a.sequenceNumber=0;a.actionNeeded=!1;a.iceStarted=!1;a.moreIceComing=!0;a.iceCandidateCount=0;a.onsignalingmessage=c.callback;a.peerConnection.onopen=function(){if(a.onopen)a.onopen()};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};a.peerConnection.oniceconnectionstatechange=function(b){if(a.oniceconnectionstatechange)a.oniceconnectionstatechange(b.currentTarget.iceConnectionState)};
a.onaddstream=null;a.onremovestream=null;a.state="new";a.markActionNeeded();return a};Agora.ChromeStableStack=function(c){var a={},b=webkitRTCPeerConnection;a.pc_config={iceServers:[]};a.con={optional:[{DtlsSrtpKeyAgreement:!0}]};c.iceServers instanceof Array?a.pc_config.iceServers=c.iceServers:(c.stunServerUrl&&(c.stunServerUrl instanceof Array?c.stunServerUrl.map(function(b){"string"===typeof b&&""!==b&&a.pc_config.iceServers.push({url:b})}):"string"===typeof c.stunServerUrl&&""!==c.stunServerUrl&&a.pc_config.iceServers.push({url:c.stunServerUrl})),c.turnServer&&(c.turnServer instanceof
Array?c.turnServer.map(function(b){"string"===typeof b.url&&""!==b.url&&a.pc_config.iceServers.push({username:b.username,credential:b.password,url:b.url})}):"string"===typeof c.turnServer.url&&""!==c.turnServer.url&&a.pc_config.iceServers.push({username:c.turnServer.username,credential:c.turnServer.password,url:c.turnServer.url})));void 0===c.audio&&(c.audio=!0);void 0===c.video&&(c.video=!0);a.mediaConstraints={mandatory:{OfferToReceiveVideo:c.video,OfferToReceiveAudio:c.audio}};a.roapSessionId=
103;a.peerConnection=new b(a.pc_config,a.con);a.peerConnection.onicecandidate=function(b){L.Logger.debug("PeerConnection: ",c.session_id);if(b.candidate)a.iceCandidateCount=a.iceCandidateCount+1;else{L.Logger.debug("State: "+a.peerConnection.iceGatheringState);if(a.ices===void 0)a.ices=0;a.ices=a.ices+1;if(a.ices>=1&&a.moreIceComing){a.moreIceComing=false;a.markActionNeeded()}}};var d=function(a){var b,d;if(c.maxVideoBW){b=a.match(/m=video.*\r\n/);d=b[0]+"b=AS:"+c.maxVideoBW+"\r\n";a=a.replace(b[0],
d)}if(c.maxAudioBW){b=a.match(/m=audio.*\r\n/);d=b[0]+"b=AS:"+c.maxAudioBW+"\r\n";a=a.replace(b[0],d)}return a};a.processSignalingMessage=function(b){L.Logger.debug("Activity on conn "+a.sessionId);b=JSON.parse(b);a.incomingMessage=b;if(a.state==="new")if(b.messageType==="OFFER"){b={sdp:b.sdp,type:"offer"};a.peerConnection.setRemoteDescription(new RTCSessionDescription(b));a.state="offer-received";a.markActionNeeded()}else a.error("Illegal message for this state: "+b.messageType+" in state "+a.state);
else if(a.state==="offer-sent")if(b.messageType==="ANSWER"){b={sdp:b.sdp,type:"answer"};L.Logger.debug("Received ANSWER: ",b.sdp);b.sdp=d(b.sdp);a.peerConnection.setRemoteDescription(new RTCSessionDescription(b));a.sendOK();a.state="established"}else if(b.messageType==="pr-answer"){b={sdp:b.sdp,type:"pr-answer"};a.peerConnection.setRemoteDescription(new RTCSessionDescription(b))}else b.messageType==="offer"?a.error("Not written yet"):a.error("Illegal message for this state: "+b.messageType+" in state "+
a.state);else if(a.state==="established")if(b.messageType==="OFFER"){b={sdp:b.sdp,type:"offer"};a.peerConnection.setRemoteDescription(new RTCSessionDescription(b));a.state="offer-received";a.markActionNeeded()}else a.error("Illegal message for this state: "+b.messageType+" in state "+a.state)};a.addStream=function(b){a.peerConnection.addStream(b);a.markActionNeeded()};a.removeStream=function(){a.markActionNeeded()};a.close=function(){a.state="closed";a.peerConnection.close()};a.markActionNeeded=function(){a.actionNeeded=
true;a.doLater(function(){a.onstablestate()})};a.doLater=function(a){window.setTimeout(a,1)};a.onstablestate=function(){var b;if(a.actionNeeded){if(a.state==="new"||a.state==="established")a.peerConnection.createOffer(function(b){b.sdp=d(b.sdp);if(b.sdp!==a.prevOffer){a.peerConnection.setLocalDescription(b);a.state="preparing-offer";a.markActionNeeded()}else L.Logger.debug("Not sending a new offer")},null,a.mediaConstraints);else if(a.state==="preparing-offer"){if(a.moreIceComing)return;a.prevOffer=
a.peerConnection.localDescription.sdp;L.Logger.debug("Sending OFFER: "+a.prevOffer);a.sendMessage("OFFER",a.prevOffer);a.state="offer-sent"}else if(a.state==="offer-received")a.peerConnection.createAnswer(function(b){a.peerConnection.setLocalDescription(b);a.state="offer-received-preparing-answer";if(a.iceStarted)a.markActionNeeded();else{L.Logger.debug((new Date).getTime()+": Starting ICE in responder");a.iceStarted=true}},null,a.mediaConstraints);else if(a.state==="offer-received-preparing-answer"){if(a.moreIceComing)return;
b=a.peerConnection.localDescription.sdp;a.sendMessage("ANSWER",b);a.state="established"}else a.error("Dazed and confused in state "+a.state+", stopping here");a.actionNeeded=false}};a.sendOK=function(){a.sendMessage("OK")};a.sendMessage=function(b,c){var d={};d.messageType=b;d.sdp=c;if(b==="OFFER"){d.offererSessionId=a.sessionId;d.answererSessionId=a.otherSessionId;d.seq=a.sequenceNumber=a.sequenceNumber+1;d.tiebreaker=Math.floor(Math.random()*429496723+1)}else{d.offererSessionId=a.incomingMessage.offererSessionId;
d.answererSessionId=a.sessionId;d.seq=a.incomingMessage.seq}a.onsignalingmessage(JSON.stringify(d))};a.error=function(a){throw"Error in RoapOnJsep: "+a;};a.sessionId=a.roapSessionId+=1;a.sequenceNumber=0;a.actionNeeded=!1;a.iceStarted=!1;a.moreIceComing=!0;a.iceCandidateCount=0;a.onsignalingmessage=c.callback;a.peerConnection.onopen=function(){if(a.onopen)a.onopen()};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};
a.peerConnection.oniceconnectionstatechange=function(b){if(a.oniceconnectionstatechange)a.oniceconnectionstatechange(b.currentTarget.iceConnectionState)};a.onaddstream=null;a.onremovestream=null;a.state="new";a.markActionNeeded();return a};Agora.ChromeCanaryStack=function(c){var a={},b=webkitRTCPeerConnection;a.pc_config={iceServers:[]};a.con={optional:[{DtlsSrtpKeyAgreement:!0}]};c.iceServers instanceof Array?a.pc_config.iceServers=c.iceServers:(c.stunServerUrl&&(c.stunServerUrl instanceof Array?c.stunServerUrl.map(function(b){"string"===typeof b&&""!==b&&a.pc_config.iceServers.push({url:b})}):"string"===typeof c.stunServerUrl&&""!==c.stunServerUrl&&a.pc_config.iceServers.push({url:c.stunServerUrl})),c.turnServer&&(c.turnServer instanceof
Array?c.turnServer.map(function(b){"string"===typeof b.url&&""!==b.url&&a.pc_config.iceServers.push({username:b.username,credential:b.password,url:b.url})}):"string"===typeof c.turnServer.url&&""!==c.turnServer.url&&a.pc_config.iceServers.push({username:c.turnServer.username,credential:c.turnServer.password,url:c.turnServer.url})));void 0===c.audio&&(c.audio=!0);void 0===c.video&&(c.video=!0);a.mediaConstraints={mandatory:{OfferToReceiveVideo:c.video,OfferToReceiveAudio:c.audio}};a.roapSessionId=
103;a.peerConnection=new b(a.pc_config,a.con);a.peerConnection.onicecandidate=function(b){L.Logger.debug("PeerConnection: ",c.session_id);if(b.candidate)a.iceCandidateCount=a.iceCandidateCount+1;else{L.Logger.debug("State: "+a.peerConnection.iceGatheringState);if(a.ices===void 0)a.ices=0;a.ices=a.ices+1;if(a.ices>=1&&a.moreIceComing){a.moreIceComing=false;a.markActionNeeded()}}};var d=function(a){var b,d;if(c.maxVideoBW){b=a.match(/m=video.*\r\n/);d=b[0]+"b=AS:"+c.maxVideoBW+"\r\n";a=a.replace(b[0],
d)}if(c.maxAudioBW){b=a.match(/m=audio.*\r\n/);d=b[0]+"b=AS:"+c.maxAudioBW+"\r\n";a=a.replace(b[0],d)}return a};a.processSignalingMessage=function(b){L.Logger.debug("Activity on conn "+a.sessionId);b=JSON.parse(b);a.incomingMessage=b;if(a.state==="new")if(b.messageType==="OFFER"){b={sdp:b.sdp,type:"offer"};a.peerConnection.setRemoteDescription(new RTCSessionDescription(b));a.state="offer-received";a.markActionNeeded()}else a.error("Illegal message for this state: "+b.messageType+" in state "+a.state);
else if(a.state==="offer-sent")if(b.messageType==="ANSWER"){b={sdp:b.sdp,type:"answer"};L.Logger.debug("Received ANSWER: ",b.sdp);b.sdp=d(b.sdp);a.peerConnection.setRemoteDescription(new RTCSessionDescription(b));a.sendOK();a.state="established"}else if(b.messageType==="pr-answer"){b={sdp:b.sdp,type:"pr-answer"};a.peerConnection.setRemoteDescription(new RTCSessionDescription(b))}else b.messageType==="offer"?a.error("Not written yet"):a.error("Illegal message for this state: "+b.messageType+" in state "+
a.state);else if(a.state==="established")if(b.messageType==="OFFER"){b={sdp:b.sdp,type:"offer"};a.peerConnection.setRemoteDescription(new RTCSessionDescription(b));a.state="offer-received";a.markActionNeeded()}else a.error("Illegal message for this state: "+b.messageType+" in state "+a.state)};a.addStream=function(b){a.peerConnection.addStream(b);a.markActionNeeded()};a.removeStream=function(){a.markActionNeeded()};a.close=function(){a.state="closed";a.peerConnection.close()};a.markActionNeeded=function(){a.actionNeeded=
true;a.doLater(function(){a.onstablestate()})};a.doLater=function(a){window.setTimeout(a,1)};a.onstablestate=function(){var b;if(a.actionNeeded){if(a.state==="new"||a.state==="established")a.peerConnection.createOffer(function(b){b.sdp=d(b.sdp);L.Logger.debug("Changed",b.sdp);if(b.sdp!==a.prevOffer){a.peerConnection.setLocalDescription(b);a.state="preparing-offer";a.markActionNeeded()}else L.Logger.debug("Not sending a new offer")},null,a.mediaConstraints);else if(a.state==="preparing-offer"){if(a.moreIceComing)return;
a.prevOffer=a.peerConnection.localDescription.sdp;L.Logger.debug("Sending OFFER: "+a.prevOffer);a.sendMessage("OFFER",a.prevOffer);a.state="offer-sent"}else if(a.state==="offer-received")a.peerConnection.createAnswer(function(b){a.peerConnection.setLocalDescription(b);a.state="offer-received-preparing-answer";if(a.iceStarted)a.markActionNeeded();else{L.Logger.debug((new Date).getTime()+": Starting ICE in responder");a.iceStarted=true}},null,a.mediaConstraints);else if(a.state==="offer-received-preparing-answer"){if(a.moreIceComing)return;
b=a.peerConnection.localDescription.sdp;a.sendMessage("ANSWER",b);a.state="established"}else a.error("Dazed and confused in state "+a.state+", stopping here");a.actionNeeded=false}};a.sendOK=function(){a.sendMessage("OK")};a.sendMessage=function(b,c){var d={};d.messageType=b;d.sdp=c;if(b==="OFFER"){d.offererSessionId=a.sessionId;d.answererSessionId=a.otherSessionId;d.seq=a.sequenceNumber=a.sequenceNumber+1;d.tiebreaker=Math.floor(Math.random()*429496723+1)}else{d.offererSessionId=a.incomingMessage.offererSessionId;
d.answererSessionId=a.sessionId;d.seq=a.incomingMessage.seq}a.onsignalingmessage(JSON.stringify(d))};a.error=function(a){throw"Error in RoapOnJsep: "+a;};a.sessionId=a.roapSessionId+=1;a.sequenceNumber=0;a.actionNeeded=!1;a.iceStarted=!1;a.moreIceComing=!0;a.iceCandidateCount=0;a.onsignalingmessage=c.callback;a.peerConnection.onopen=function(){if(a.onopen)a.onopen()};a.peerConnection.onaddstream=function(b){if(a.onaddstream)a.onaddstream(b)};a.peerConnection.onremovestream=function(b){if(a.onremovestream)a.onremovestream(b)};
a.peerConnection.oniceconnectionstatechange=function(b){if(a.oniceconnectionstatechange)a.oniceconnectionstatechange(b.currentTarget.iceConnectionState)};a.onaddstream=null;a.onremovestream=null;a.state="new";a.markActionNeeded();return a};Agora.sessionId=103;
Agora.Connection=function(c){var a={};c.session_id=Agora.sessionId+=1;if("undefined"!==typeof module&&module.exports)L.Logger.error("Publish/subscribe video/audio streams not supported yet"),a=Agora.FcStack(c);else if(null!==window.navigator.userAgent.match("Firefox"))a.browser="mozilla",a=Agora.FirefoxStack(c);else if(26<=window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1])L.Logger.debug("Stable"),a=Agora.ChromeStableStack(c),a.browser="chrome-stable";else if(40<=window.navigator.userAgent.toLowerCase().indexOf("chrome"))L.Logger.debug("Canary!"),a=
Agora.ChromeCanaryStack(c),a.browser="chrome-canary";else throw a.browser="none","WebRTC stack not available";return a};
Agora.GetUserMedia=function(c,a,b){navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;if(c.screen)if(L.Logger.debug("Screen access requested"),34>window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1])b({code:"This browser does not support screen sharing"});else{var d="okeephmleflklcdebijnponpabbmmgeo";c.extensionId&&(L.Logger.debug("extensionId supplied, using "+c.extensionId),d=c.extensionId);L.Logger.debug("Screen access on chrome stable, looking for extension");
try{chrome.runtime.sendMessage(d,{getStream:!0},function(d){if(d===void 0){L.Logger.debug("Access to screen denied");b({code:"Access to screen denied"})}else{c={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:d.streamId}}};navigator.getMedia(c,a,b)}})}catch(e){L.Logger.debug("Agora screensharing plugin is not accessible"),b({code:"no_plugin_present"})}}else"undefined"!==typeof module&&module.exports?L.Logger.error("Video/audio streams not supported yet"):navigator.getMedia(c,a,b)};Agora.Stream=function(c){function a(a,b){return{mandatory:{minWidth:a,minHeight:b,maxWidth:a,maxHeight:b},optional:[]}}var b=Agora.EventDispatcher(c);b.stream=c.stream;b.url=c.url;b.onClose=void 0;b.local=!1;b.video=c.video;b.audio=c.audio;b.screen=c.screen;b.videoSize=c.videoSize;if(void 0!==b.videoSize&&(!(b.videoSize instanceof Array)||4!==b.videoSize.length))throw Error("Invalid Video Size");if(void 0===c.local||!0===c.local)b.local=!0;b.initialized=!b.local;var d={"true":!0,unspecified:!0,sif:a(320,
240),vga:a(640,480),hd720p:a(1280,720)};b.onPlayAudio=void 0;b.onPauseAudio=void 0;b.onPlayVideo=void 0;b.onPauseVideo=void 0;b.getId=function(){return c.streamID};b.getAttributes=function(){return c.attributes};b.hasAudio=function(){return c.audio};b.hasVideo=function(){return c.video};b.hasScreen=function(){return c.screen};b.setVideo=function(a,f){a+="";return void 0!==d[a]?(b.video=c.video=d[a],c.attributes=c.attributes||{},c.attributes.resolution=a,"object"===typeof f&&f instanceof Array&&1<
f.length&&(c.attributes.minFrameRate=f[0],c.attributes.maxFrameRate=f[1]),!0):!1};b.setAudio=function(a){return!0===a||!1===a?(b.audio=c.audio=a,!0):!1};b.init=function(a,d){var g=d;void 0===g&&(g=2);if(!0===b.initialized)"function"===typeof a&&a({type:"warning",msg:"STREAM_ALREADY_INITIALIZED"});else if(!0!==b.local)"function"===typeof a&&a({type:"warning",msg:"STREAM_NOT_LOCAL"});else try{if((c.audio||c.video||c.screen)&&void 0===c.url){L.Logger.debug("Requested access to local media");var i=c.video;
!0===i&&void 0!==b.videoSize&&(i={mandatory:{minWidth:b.videoSize[0],minHeight:b.videoSize[1],maxWidth:b.videoSize[2],maxHeight:b.videoSize[3]}});var h={video:i,audio:c.audio,fake:c.fake};c.screen&&(h={video:{mandatory:{chromeMediaSource:"screen",maxWidth:screen.availWidth,maxHeight:screen.availHeight}}});if(!(null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&35>=window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1])&&(!0===h.video&&(h.video={mandatory:{}},h.video.mandatory.maxFrameRate=
c.attributes.maxFrameRate,h.video.mandatory.minFrameRate=c.attributes.minFrameRate),void 0!==h.video.mandatory&&void 0!==h.video.mandatory.maxWidth))switch(h.video.mandatory.maxWidth){case 320:c.attributes.maxVideoBW=512;break;case 640:c.attributes.maxVideoBW=1024;break;case 1280:c.attributes.maxVideoBW=2048;break;default:c.attributes.maxVideoBW=void 0}L.Logger.debug(h);Agora.GetUserMedia(h,function(a){L.Logger.info("User has granted access to local media.");b.stream=a;a=Agora.MediaEvent({type:"access-accepted"});
b.dispatchEvent(a);b.initialized=!0},function(c){c={type:"error",msg:c.name||c};switch(c.msg){case "Starting video failed":case "TrackStartError":b.setVideo("unspecified");b.videoSize=void 0;if(0<g){setTimeout(function(){b.init(a,g-1)},1);return}c.msg="MEDIA_OPTION_INVALID";break;case "DevicesNotFoundError":c.msg="DEVICES_NOT_FOUND";break;case "NotSupportedError":c.msg="NOT_SUPPORTED";break;case "PermissionDeniedError":c.msg="PERMISSION_DENIED";break;case "PERMISSION_DENIED":break;case "ConstraintNotSatisfiedError":c.msg=
"CONSTRAINT_NOT_SATISFIED";break;default:c.msg||(c.msg="UNDEFINED")}L.Logger.error("Media access:",c.msg);"function"===typeof a&&a(c)})}else"function"===typeof a&&a({type:"warning",msg:"STREAM_HAS_NO_MEDIA_ATTRIBUTES"})}catch(j){L.Logger.error("Stream init:",j),"function"===typeof a&&a({type:"error",msg:j.message||j})}};b.onRemove=function(){};b.close=function(){if(!0===b.initialized&&!0===b.local){if("function"===typeof b.onClose)b.onClose();void 0!==b.stream&&b.stream.stop();b.stream=void 0;b.initialized=
!1}};b.enableAudio=function(){return b.hasAudio()&&b.initialized&&void 0!==b.stream&&!0!==b.stream.getAudioTracks()[0].enabled?b.stream.getAudioTracks()[0].enabled=!0:!1};b.disableAudio=function(){return b.hasAudio()&&b.initialized&&void 0!==b.stream&&b.stream.getAudioTracks()[0].enabled?(b.stream.getAudioTracks()[0].enabled=!1,!0):!1};b.enableVideo=function(){return b.hasVideo()&&b.initialized&&void 0!==b.stream&&!0!==b.stream.getVideoTracks()[0].enabled?b.stream.getVideoTracks()[0].enabled=!0:!1};
b.disableVideo=function(){return b.hasVideo()&&b.initialized&&void 0!==b.stream&&b.stream.getVideoTracks()[0].enabled?(b.stream.getVideoTracks()[0].enabled=!1,!0):!1};b.playAudio=function(a,c){if(b.enableAudio()&&"function"===typeof b.onPlayAudio)return b.onPlayAudio(a,c);"function"===typeof c&&c("unable to call playAudio")};b.pauseAudio=function(a,c){if(b.disableAudio()&&"function"===typeof b.onPauseAudio)return b.onPauseAudio(a,c);"function"===typeof c&&c("unable to call pauseAudio")};b.playVideo=
function(a,c){if(b.enableVideo()&&"function"===typeof b.onPlayVideo)return b.onPlayVideo(a,c);"function"===typeof c&&c("unable to call playVideo")};b.pauseVideo=function(a,c){if(b.disableVideo()&&"function"===typeof b.onPauseVideo)return b.onPauseVideo(a,c);"function"===typeof c&&c("unable to call pauseVideo")};return b};Agora.Client=function(c){function a(){var a=arguments[0];if("function"===typeof a){var b=Array.prototype.slice.call(arguments,1);a.apply(null,b)}}var b=Agora.EventDispatcher(c),d,e,f,g;b.localStreams={};b.remoteStreams={};b.socket=void 0;b.state=0;b.vos_ip=void 0;b.vos_port=void 0;b.ticket=void 0;b.cid=void 0;b.uid=void 0;b.vocs="http://vocsweb.agorabeckon.com:9999/getvocs/jsonp";d=function(a,c,d){var k=a.host;void 0!==b.socket?b.socket.socket.connect():(b.socket=io.connect(k,{reconnect:!1,secure:!1}),
b.socket.on("onAddStream",function(a){var c=Agora.Stream({streamID:a.id,local:!1,audio:a.audio,video:a.video,screen:a.screen,attributes:a.attributes});b.remoteStreams[a.id]=c;a=Agora.StreamEvent({type:"stream-added",stream:c});b.dispatchEvent(a)}),b.socket.on("onRemoveStream",function(a){var c=b.remoteStreams[a.id];delete b.remoteStreams[a.id];g(c);a=Agora.StreamEvent({type:"stream-removed",stream:c});b.dispatchEvent(a)}),b.socket.on("onPublishStream",function(a){L.Logger.info("Stream published");
a=Agora.StreamEvent({type:"stream-published",stream:b.localStreams[a.id]});b.dispatchEvent(a)}),b.socket.on("disconnect",function(){L.Logger.info("Socket disconnected");if(0!==b.state){var a=Agora.ClientEvent({type:"client-disconnected"});b.dispatchEvent(a)}}),b.socket.on("joinSuccess",function(){var a=Agora.ClientEvent({type:"join-success"});b.dispatchEvent(a)}),e("token",a,c,d))};e=function(c,d,j,k){if(void 0===b.socket)a(k,"socket error");else try{b.socket.emit(c,d,function(a,b){"success"===a?
"function"===typeof j&&j(b):"function"===typeof k&&k(b)})}catch(e){L.Logger.error("sendMessageSocket error: ",e)}};f=function(a,c,d,k){if(void 0===b.socket)L.Logger.error("Error in sendSDPSocket(): socket not ready");else try{b.socket.emit(a,c,d,function(a,b){void 0!==k&&k(a,b)})}catch(e){L.Logger.error("Error in sendSDPSocket: ",e)}};g=function(a){void 0!==a.stream&&(a.onRemove(),a.pc.close(),a.local&&a.stream.stop())};b.init=function(d,h,j){0!==b.state?(L.Logger.error("Gateway already connecting/connected"),
a(j,b.state)):$.ajax({url:b.vocs+"?key="+d+"&name="+h,dataType:"jsonp",success:function(a){var d=a.vos_list[0];c.host=d.p;b.vos_ip=d.ip;b.vos_port=d.port;b.ticket=d.ticket;b.cid=a.cid;b.uid=a.uid;a=Agora.ClientEvent({type:"client-initialized",attr:a});b.dispatchEvent(a)}})};b.connect=function(i){0!==b.state?(L.Logger.error("Gateway already connecting/connected"),a(i,b.state)):(b.state=1,d(c,function(a){b.stunServerUrl=a.stunServerUrl;b.turnServer=a.turnServer;b.state=2;c.defaultVideoBW=a.defaultVideoBW;
c.maxVideoBW=a.maxVideoBW;L.Logger.info("Gateway connected.");a=Agora.ClientEvent({type:"client-connected"});b.dispatchEvent(a)},function(b){L.Logger.error("Not connected! Error: "+b);a(i,b)}))};b.disconnect=function(){var a=Agora.ClientEvent({type:"client-disconnected"});b.dispatchEvent(a)};b.join=function(a,c){e("customMessage",{type:"login",payload:{vos_ip:b.vos_ip,vos_port:b.vos_port,vos_ticket:b.ticket,vos_cid:b.cid,vos_uid:b.uid}},a,c)};b.leave=function(){e("customMessage",{type:"leave"},function(){},
function(){})};b.publish=function(d,h){if("object"!==typeof d||null===d)a(h,"stream is invalid");else if(("object"!==typeof d.stream||null===d.stream)&&void 0===d.url)a(h,"stream access not ready");else{var j=d.getAttributes()||{};j.maxVideoBW=j.maxVideoBW||c.defaultVideoBW;j.maxVideoBW>c.maxVideoBW&&(j.maxVideoBW=c.maxVideoBW);if(d.local&&void 0===b.localStreams[d.getId()]&&(d.hasAudio()||d.hasVideo()||d.hasScreen()))void 0!==d.url?f("publish",{state:"url",audio:d.hasAudio(),video:d.hasVideo(),attributes:d.getAttributes()},
d.url,function(c,j){if(c==="success"){L.Logger.info("Stream published");d.getId=function(){return j};b.localStreams[j]=d;d.onClose=function(){b.unpublish(d)}}else{L.Logger.info("Error when publishing the stream",c);a(h,c)}}):(d.pc=Agora.Connection({callback:function(c){f("publish",{state:"offer",audio:d.hasAudio(),video:d.hasVideo(),attributes:d.getAttributes()},c,function(c,j){if(c==="error")a(h,c);else{d.pc.onsignalingmessage=function(a){d.pc.onsignalingmessage=function(){};f("publish",{state:"ok",
audio:d.hasAudio(),video:d.hasVideo(),screen:d.hasScreen(),attributes:d.getAttributes()},a);d.getId=function(){return j.id};b.localStreams[j.id]=d;d.onClose=function(){b.unpublish(d)};d.onPlayAudio=function(a,b){e("customMessage",{type:"control",payload:{action:"audio-out-on"}},a,b)};d.onPauseAudio=function(a,b){e("customMessage",{type:"control",payload:{action:"audio-out-off"}},a,b)};d.onPlayVideo=function(a,b){e("customMessage",{type:"control",payload:{action:"video-out-on"}},a,b)};d.onPauseVideo=
function(a){e("customMessage",{type:"control",payload:{action:"video-out-off"}},a,h)}};d.pc.oniceconnectionstatechange=function(c){if(c==="failed"){e("unpublish",d.getId(),function(){},function(){});d.pc.close();d.pc=void 0;delete b.localStreams[d.getId()];d.getId=function(){return null};d.onClose=void 0;d.onPlayAudio=void 0;d.onPauseAudio=void 0;d.onPlayVideo=void 0;d.onPauseVideo=void 0;a(h,"Peer connection failied")}};d.pc.processSignalingMessage(c)}})},iceServers:[],stunServerUrl:b.stunServerUrl,
turnServer:b.turnServer,maxAudioBW:j.maxAudioBW,maxVideoBW:j.maxVideoBW}),d.pc.addStream(d.stream))}};b.unpublish=function(c,d){"object"!==typeof c||null===c?a(d,"stream is invalid"):c.local&&void 0!==b.localStreams[c.getId()]?e("unpublish",c.getId(),function(){if((c.hasAudio()||c.hasVideo()||c.hasScreen())&&void 0===c.url)c.pc.close(),c.pc=void 0;delete b.localStreams[c.getId()];c.getId=function(){return null};c.onClose=void 0;c.onPlayAudio=void 0;c.onPauseAudio=void 0;c.onPlayVideo=void 0;c.onPauseVideo=
void 0},d):saftCall(d,"stream is not local")};b.subscribe=function(c,d){"object"!==typeof c||null===c?a(d,"stream is invalid"):c.local?a(d,"stream is local"):c.hasAudio()||c.hasVideo()||c.hasScreen()?(c.pc=Agora.Connection({callback:function(b){f("subscribe",{streamId:c.getId(),audio:c.hasAudio(),video:c.hasVideo()},b,function(b){"error"===b?a(d,b):c.pc.processSignalingMessage(b)})},nop2p:!0,audio:c.hasAudio(),video:c.hasVideo(),iceServers:[],stunServerUrl:b.stunServerUrl,turnServer:b.turnServer}),
c.pc.onaddstream=function(a){L.Logger.info("Stream subscribed");c.stream=a.stream;a=Agora.StreamEvent({type:"stream-subscribed",stream:c});b.dispatchEvent(a);c.onPlayAudio=function(a,b){e("customMessage",{type:"control",payload:{action:"audio-in-on"}},a,b)};c.onPauseAudio=function(a,b){e("customMessage",{type:"control",payload:{action:"audio-in-off"}},a,b)};c.onPlayVideo=function(a,b){e("customMessage",{type:"control",payload:{action:"video-in-on"}},a,b)};c.onPauseVideo=function(a,b){e("customMessage",
{type:"control",payload:{action:"video-in-off"}},a,b)}},c.pc.oniceconnectionstatechange=function(b){"failed"===b&&(e("unsubscribe",c.getId(),function(){},function(){}),g(c),c.onPlayAudio=void 0,c.onPauseAudio=void 0,c.onPlayVideo=void 0,c.onPauseVideo=void 0,a(d,"Peer connection failed"))},L.Logger.info("Subscribing to: "+c.getId())):a(d,"stream does not have video/audio/screen")};b.unsubscribe=function(c,d){"object"!==typeof c||null===c?a(d,"stream is invalid"):void 0!==b.socket?c.local||e("unsubscribe",
c.getId(),function(b){"error"===b?a(d,b):(g(c),c.onPlayAudio=void 0,c.onPauseAudio=void 0,c.onPlayVideo=void 0,c.onPauseVideo=void 0)},function(b){L.Logger.error("Error calling unsubscribe");a(d,b)}):a(d,"socket error")};return b};L.Logger=function(){var c=0,a;a=function(){var a=arguments[0],d=arguments;if(!(a<c)){switch(a){case 0:d[0]="DEBUG:";break;case 1:d[0]="TRACE:";break;case 2:d[0]="INFO:";break;case 3:d[0]="WARNING:";break;case 4:d[0]="ERROR:";break;default:return}console.log.apply(console,d)}};return{DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5,setLogLevel:function(a){5<a?a=5:0>a&&(a=0);c=a},log:a,debug:function(){for(var b=[0],c=0;c<arguments.length;c++)b.push(arguments[c]);a.apply(this,b)},trace:function(){for(var b=
[1],c=0;c<arguments.length;c++)b.push(arguments[c]);a.apply(this,b)},info:function(){for(var b=[2],c=0;c<arguments.length;c++)b.push(arguments[c]);a.apply(this,b)},warning:function(){for(var b=[3],c=0;c<arguments.length;c++)b.push(arguments[c]);a.apply(this,b)},error:function(){for(var b=[4],c=0;c<arguments.length;c++)b.push(arguments[c]);a.apply(this,b)}}}();L.Base64=function(){var c,a,b,d,e,f,g,i,h;c="A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,0,1,2,3,4,5,6,7,8,9,+,/".split(",");a=[];for(e=0;e<c.length;e+=1)a[c[e]]=e;f=function(a){b=a;d=0};g=function(){var a;if(!b||d>=b.length)return-1;a=b.charCodeAt(d)&255;d+=1;return a};i=function(){if(!b)return-1;for(;;){if(d>=b.length)return-1;var c=b.charAt(d);d+=1;if(a[c])return a[c];if("A"===c)return 0}};h=function(a){a=a.toString(16);1===a.length&&
(a="0"+a);return unescape("%"+a)};return{encodeBase64:function(a){var b,d,h;f(a);a="";b=Array(3);d=0;for(h=!1;!h&&-1!==(b[0]=g());)if(b[1]=g(),b[2]=g(),a+=c[b[0]>>2],-1!==b[1]?(a+=c[b[0]<<4&48|b[1]>>4],-1!==b[2]?(a+=c[b[1]<<2&60|b[2]>>6],a+=c[b[2]&63]):(a+=c[b[1]<<2&60],a+="=",h=!0)):(a+=c[b[0]<<4&48],a+="=",a+="=",h=!0),d+=4,76<=d)a+="\n",d=0;return a},decodeBase64:function(a){var b,c;f(a);a="";b=Array(4);for(c=!1;!c&&-1!==(b[0]=i())&&-1!==(b[1]=i());)b[2]=i(),b[3]=i(),a+=h(b[0]<<2&255|b[1]>>4),
-1!==b[2]?(a+=h(b[1]<<4&255|b[2]>>2),-1!==b[3]?a+=h(b[2]<<6&255|b[3]):c=!0):c=!0;return a}}}();(function(){function c(){(new L.ElementQueries).init()}this.L=this.L||{};this.L.ElementQueries=function(){function a(a){a||(a=document.documentElement);a=getComputedStyle(a,"fontSize");return parseFloat(a)||16}function b(b,c){var d=c.replace(/[0-9]*/,""),c=parseFloat(c);switch(d){case "px":return c;case "em":return c*a(b);case "rem":return c*a();case "vw":return c*document.documentElement.clientWidth/100;case "vh":return c*document.documentElement.clientHeight/100;case "vmin":case "vmax":return c*
(0,Math["vmin"===d?"min":"max"])(document.documentElement.clientWidth/100,document.documentElement.clientHeight/100);default:return c}}function c(a){this.element=a;this.options=[];var d,e,f,g=0,p=0,i,n,l,m,o;this.addOption=function(a){this.options.push(a)};var q=["min-width","min-height","max-width","max-height"];this.call=function(){g=this.element.offsetWidth;p=this.element.offsetHeight;l={};d=0;for(e=this.options.length;d<e;d++)f=this.options[d],i=b(this.element,f.value),n="width"==f.property?g:
p,o=f.mode+"-"+f.property,m="","min"==f.mode&&n>=i&&(m+=f.value),"max"==f.mode&&n<=i&&(m+=f.value),l[o]||(l[o]=""),m&&-1===(" "+l[o]+" ").indexOf(" "+m+" ")&&(l[o]+=" "+m);for(var a in q)l[q[a]]?this.element.setAttribute(q[a],l[q[a]].substr(1)):this.element.removeAttribute(q[a])}}function e(a,b){a.elementQueriesSetupInformation?a.elementQueriesSetupInformation.addOption(b):(a.elementQueriesSetupInformation=new c(a),a.elementQueriesSetupInformation.addOption(b),new ResizeSensor(a,function(){a.elementQueriesSetupInformation.call()}));
a.elementQueriesSetupInformation.call()}function f(a){for(var b,a=a.replace(/'/g,'"');null!==(b=i.exec(a));)if(5<b.length){var c=b[1]||b[5],d=b[2],f=b[3];b=b[4];var g=void 0;document.querySelectorAll&&(g=document.querySelectorAll.bind(document));!g&&"undefined"!==typeof $$&&(g=$$);!g&&"undefined"!==typeof jQuery&&(g=jQuery);if(!g)throw"No document.querySelectorAll, jQuery or Mootools's $$ found.";for(var c=g(c),g=0,r=c.length;g<r;g++)e(c[g],{mode:d,property:f,value:b})}}function g(a){var b="";if(a)if("string"===
typeof a)a=a.toLowerCase(),(-1!==a.indexOf("min-width")||-1!==a.indexOf("max-width"))&&f(a);else for(var c=0,d=a.length;c<d;c++)1===a[c].type?(b=a[c].selectorText||a[c].cssText,-1!==b.indexOf("min-height")||-1!==b.indexOf("max-height")?f(b):(-1!==b.indexOf("min-width")||-1!==b.indexOf("max-width"))&&f(b)):4===a[c].type&&g(a[c].cssRules||a[c].rules)}var i=/,?([^,\n]*)\[[\s\t]*(min|max)-(width|height)[\s\t]*[~$\^]?=[\s\t]*"([^"]*)"[\s\t]*]([^\n\s\{]*)/mgi;this.init=function(){for(var a=0,b=document.styleSheets.length;a<
b;a++)g(document.styleSheets[a].cssText||document.styleSheets[a].cssRules||document.styleSheets[a].rules)}};window.addEventListener?window.addEventListener("load",c,!1):window.attachEvent("onload",c);this.L.ResizeSensor=function(a,b){function c(a,b){window.OverflowEvent?a.addEventListener("overflowchanged",function(a){b.call(this,a)}):(a.addEventListener("overflow",function(a){b.call(this,a)}),a.addEventListener("underflow",function(a){b.call(this,a)}))}function e(){this.q=[];this.add=function(a){this.q.push(a)};
var a,b;this.call=function(){a=0;for(b=this.q.length;a<b;a++)this.q[a].call()}}function f(a,b){function f(){var b=!1,c=a.resizeSensor.offsetWidth,d=a.resizeSensor.offsetHeight;i!=c&&(r.width=c-1+"px",n.width=c+1+"px",b=!0,i=c);p!=d&&(r.height=d-1+"px",n.height=d+1+"px",b=!0,p=d);return b}if(a.resizedAttached){if(a.resizedAttached){a.resizedAttached.add(b);return}}else a.resizedAttached=new e,a.resizedAttached.add(b);var g=function(){f()&&a.resizedAttached.call()};a.resizeSensor=document.createElement("div");
a.resizeSensor.className="resize-sensor";a.resizeSensor.style.cssText="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1;";a.resizeSensor.innerHTML='<div class="resize-sensor-overflow" style="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1;"><div></div></div><div class="resize-sensor-underflow" style="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1;"><div></div></div>';a.appendChild(a.resizeSensor);
if("absolute"!==(a.currentStyle?a.currentStyle.position:window.getComputedStyle?window.getComputedStyle(a,null).getPropertyValue("position"):a.style.position))a.style.position="relative";var i=-1,p=-1,r=a.resizeSensor.firstElementChild.firstChild.style,n=a.resizeSensor.lastElementChild.firstChild.style;f();c(a.resizeSensor,g);c(a.resizeSensor.firstElementChild,g);c(a.resizeSensor.lastElementChild,g)}if("array"===typeof a||"undefined"!==typeof jQuery&&a instanceof jQuery||"undefined"!==typeof Elements&&
a instanceof Elements)for(var g=0,i=a.length;g<i;g++)f(a[g],b);else f(a,b)}})();Agora.View=function(c){c=Agora.EventDispatcher(c);c.url=".";return c};Agora.VideoPlayer=function(c){var a=Agora.View({});a.id=c.id;a.stream=c.stream.stream;a.elementID=c.elementID;a.destroy=function(){a.video.pause();delete a.resizer;a.parentNode.removeChild(a.div)};a.resize=function(){var b=a.container.offsetWidth,d=a.container.offsetHeight;if(c.stream.screen)0.75*b<d?(a.video.style.width=b+"px",a.video.style.height=0.75*b+"px",a.video.style.top=-(0.75*b/2-d/2)+"px",a.video.style.left="0px"):(a.video.style.height=d+"px",a.video.style.width=4/3*d+"px",a.video.style.left=
-(4/3*d/2-b/2)+"px",a.video.style.top="0px");else if(b!==a.containerWidth||d!==a.containerHeight)0.75*b>d?(a.video.style.width=b+"px",a.video.style.height=0.75*b+"px",a.video.style.top=-(0.75*b/2-d/2)+"px",a.video.style.left="0px"):(a.video.style.height=d+"px",a.video.style.width=4/3*d+"px",a.video.style.left=-(4/3*d/2-b/2)+"px",a.video.style.top="0px");a.containerWidth=b;a.containerHeight=d};L.Logger.debug("Creating URL from stream "+a.stream);a.stream_url=(window.URL||webkitURL).createObjectURL(a.stream);
a.div=document.createElement("div");a.div.setAttribute("id","player_"+a.id);a.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;");a.loader=document.createElement("img");a.loader.setAttribute("style","width: 16px; height: 16px; position: absolute; top: 50%; left: 50%; margin-top: -8px; margin-left: -8px");a.loader.setAttribute("id","back_"+a.id);a.loader.setAttribute("src",a.url+"/assets/loader.gif");a.video=document.createElement("video");
a.video.setAttribute("id","stream"+a.id);a.video.setAttribute("style","width: 100%; height: 100%; position: absolute");a.video.setAttribute("autoplay","autoplay");c.stream.local&&(a.video.volume=0);void 0!==a.elementID?(document.getElementById(a.elementID).appendChild(a.div),a.container=document.getElementById(a.elementID)):(document.body.appendChild(a.div),a.container=document.body);a.parentNode=a.div.parentNode;a.div.appendChild(a.loader);a.div.appendChild(a.video);a.video.addEventListener("playing",
function(){var b=function(){a.video.videoWidth*a.video.videoHeight>4?L.Logger.info("video dimensions:",a.video.videoWidth,a.video.videoHeight):setTimeout(b,50)};b()});a.containerWidth=0;a.containerHeight=0;a.resizer=new L.ResizeSensor(a.container,a.resize);a.resize();a.bar=new Agora.Bar({elementID:"player_"+a.id,id:a.id,stream:c.stream,media:a.video,options:c.options});a.div.onmouseover=function(){a.bar.display()};a.div.onmouseout=function(){a.bar.hide()};a.video.src=a.stream_url;return a};Agora.AudioPlayer=function(c){var a=Agora.View({}),b,d;a.id=c.id;a.stream=c.stream.stream;a.elementID=c.elementID;L.Logger.debug("Creating URL from stream "+a.stream);a.stream_url=(window.URL||webkitURL).createObjectURL(a.stream);a.audio=document.createElement("audio");a.audio.setAttribute("id","stream"+a.id);a.audio.setAttribute("style","width: 100%; height: 100%; position: absolute");a.audio.setAttribute("autoplay","autoplay");c.stream.local&&(a.audio.volume=0);c.stream.local&&(a.audio.volume=0);
void 0!==a.elementID?(a.destroy=function(){a.audio.pause();a.parentNode.removeChild(a.div)},b=function(){a.bar.display()},d=function(){a.bar.hide()},a.div=document.createElement("div"),a.div.setAttribute("id","player_"+a.id),a.div.setAttribute("style","width: 100%; height: 100%; position: relative; overflow: hidden;"),document.getElementById(a.elementID).appendChild(a.div),a.container=document.getElementById(a.elementID),a.parentNode=a.div.parentNode,a.div.appendChild(a.audio),a.bar=new Agora.Bar({elementID:"player_"+
a.id,id:a.id,stream:c.stream,media:a.audio,options:c.options}),a.div.onmouseover=b,a.div.onmouseout=d):(a.destroy=function(){a.audio.pause();a.parentNode.removeChild(a.audio)},document.body.appendChild(a.audio),a.parentNode=document.body);a.audio.src=a.stream_url;return a};Agora.Bar=function(c){var a=Agora.View({}),b,d;a.elementID=c.elementID;a.id=c.id;a.div=document.createElement("div");a.div.setAttribute("id","bar_"+a.id);a.bar=document.createElement("div");a.bar.setAttribute("style","width: 100%; height: 15%; max-height: 30px; position: absolute; bottom: 0; right: 0; background-color: rgba(255,255,255,0.62)");a.bar.setAttribute("id","subbar_"+a.id);a.link=document.createElement("a");a.link.setAttribute("href","http://www.lynckia.com/");a.link.setAttribute("target",
"_blank");a.logo=document.createElement("img");a.logo.setAttribute("style","width: 100%; height: 100%; max-width: 30px; position: absolute; top: 0; left: 2px;");a.logo.setAttribute("alt","Lynckia");a.logo.setAttribute("src",a.url+"/assets/star.svg");d=function(c){"block"!==c?c="none":clearTimeout(b);a.div.setAttribute("style","width: 100%; height: 100%; position: relative; bottom: 0; right: 0; display:"+c)};a.display=function(){d("block")};a.hide=function(){b=setTimeout(d,1E3)};document.getElementById(a.elementID).appendChild(a.div);
a.div.appendChild(a.bar);if(!c.stream.screen&&(void 0===c.options||void 0===c.options.speaker||!0===c.options.speaker))a.speaker=new Agora.Speaker({elementID:"subbar_"+a.id,id:a.id,stream:c.stream,media:c.media});a.display();a.hide();return a};Agora.Speaker=function(c){var a=Agora.View({}),b,d,e,f=50;a.elementID=c.elementID;a.media=c.media;a.id=c.id;a.stream=c.stream;a.div=document.createElement("div");a.div.setAttribute("style","width: 40%; height: 100%; max-width: 32px; position: absolute; right: 0;z-index:0;");a.icon=document.createElement("img");a.icon.setAttribute("id","volume_"+a.id);a.icon.setAttribute("src",a.url+"/assets/sound48.png");a.icon.setAttribute("style","width: 80%; height: 100%; position: absolute;");a.div.appendChild(a.icon);
a.stream.local?(d=function(){a.media.muted=!0;a.icon.setAttribute("src",a.url+"/assets/mute48.png");a.stream.stream.getAudioTracks()[0].enabled=!1},e=function(){a.media.muted=!1;a.icon.setAttribute("src",a.url+"/assets/sound48.png");a.stream.stream.getAudioTracks()[0].enabled=!0},a.icon.onclick=function(){a.media.muted?e():d()}):(a.picker=document.createElement("input"),a.picker.setAttribute("id","picker_"+a.id),a.picker.type="range",a.picker.min=0,a.picker.max=100,a.picker.step=10,a.picker.value=
f,a.picker.setAttribute("orient","vertical"),a.div.appendChild(a.picker),a.media.volume=a.picker.value/100,a.media.muted=!1,a.picker.oninput=function(){0<a.picker.value?(a.media.muted=!1,a.icon.setAttribute("src",a.url+"/assets/sound48.png")):(a.media.muted=!0,a.icon.setAttribute("src",a.url+"/assets/mute48.png"));a.media.volume=a.picker.value/100},b=function(b){a.picker.setAttribute("style","background: transparent; width: 32px; height: 100px; position: absolute; bottom: 90%; z-index: 1;"+a.div.offsetHeight+
"px; right: 0px; -webkit-appearance: slider-vertical; display: "+b)},d=function(){a.icon.setAttribute("src",a.url+"/assets/mute48.png");f=a.picker.value;a.picker.value=0;a.media.volume=0;a.media.muted=!0},e=function(){a.icon.setAttribute("src",a.url+"/assets/sound48.png");a.picker.value=f;a.media.volume=a.picker.value/100;a.media.muted=!1},a.icon.onclick=function(){a.media.muted?e():d()},a.div.onmouseover=function(){b("block")},a.div.onmouseout=function(){b("none")},b("none"));document.getElementById(a.elementID).appendChild(a.div);
return a};
